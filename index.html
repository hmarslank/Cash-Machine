<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Profits AI: Elevate Your Stock Content</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- New Palette (Inspired by Imagino):
         Primary Background: #F8F9FA (Very light gray)
         Secondary Backgrounds/Cards: #FFFFFF (White)
         Accent Color (Primary): #8B5CF6 (Indigo-500)
         Accent Color (Hover/Active/Darker): #7C3AED (Indigo-600)
         Light Accent: #E0E7FF (Indigo-100)
         Text: #333333 (Dark Gray), #4B5563 (Medium Gray), #6B7280 (Light Gray)
         Success: #10B981 (Emerald-500)
         Error: #EF4444 (Red-500)
    -->
    <style>
        /* Base styles for modern, sleek look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8F9FA; /* Very light gray */
            color: #333333; /* Dark gray for main text */
            line-height: 1.6;
        }

        .container {
            max-width: 1200px; /* Wider container for spacious feel */
            margin-left: auto;
            margin-right: auto;
            padding: 1.5rem; /* More consistent padding */
        }

        /* Header Specific */
        .app-header {
            background: linear-gradient(to right, #ffffff, #F9FAFB); /* Subtle gradient for header */
            border-bottom: 1px solid #F3F4F6; /* Very light border */
        }

        /* Navigation Buttons */
        .nav-btn {
            transition: all 0.3s ease-in-out; /* Smoother transitions */
            border-bottom: 3px solid transparent;
            padding: 0.8rem 1rem; /* More vertical padding, consistent horizontal */
            color: #6B7280; /* Neutral gray for inactive */
            font-weight: 500; /* Medium weight for sleekness */
            letter-spacing: -0.01em; /* Tighter letter spacing */
            white-space: nowrap; /* Prevent wrapping */
        }
        .nav-btn.active {
            color: #8B5CF6; /* Primary Accent (Indigo-500) */
            border-bottom-color: #8B5CF6;
            font-weight: 700; /* Bolder when active */
        }
        .nav-btn:hover:not(.active) {
            color: #7C3AED; /* Darker Indigo on hover for inactive */
        }

        /* Section Content */
        .step-content { 
            display: none; 
            animation: fadeIn 0.5s ease-out forwards; /* Ensures fade-in on step change */
        }
        .step-content.active { display: block; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* Loading Spinner */
        .loading-spinner {
            border: 4px solid #E5E7EB; /* Lighter gray border */
            border-top: 4px solid #8B5CF6; /* Primary Accent (Indigo-500) */
            border-radius: 50%;
            width: 36px; /* Slightly larger */
            height: 36px;
            animation: spin 1s linear infinite;
            margin: 1.5rem auto; /* More margin */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Card Styles */
        .card-panel {
            background-color: #FFFFFF;
            border-radius: 1.25rem; /* More rounded */
            box-shadow: 0 8px 30px rgba(0,0,0,0.08); /* Softer, larger shadow */
            padding: 3rem; /* Generous padding */
            margin-bottom: 2.5rem; /* Space between sections */
            border: 1px solid #F3F4F6; /* Very subtle border */
        }

        /* Niche & Keyword Cards/Chips */
        .niche-card, .keyword-chip {
            background-color: #FDFDFE; /* Off-white for subtle contrast */
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem; /* More rounded */
            padding: 0.8rem 1.3rem; /* More padding */
            font-size: 0.95rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04); /* Very subtle shadow */
        }
        .niche-card:hover, .keyword-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            background-color: #EDE9FE; /* Light Indigo hover */
        }
        .niche-card.selected {
            border-color: #8B5CF6; /* Primary Accent (Indigo-500) */
            background-color: #EDE9FE; /* Lighter Indigo */
            font-weight: 600;
            color: #5B21B6; /* Darker Indigo text */
        }
        /* Specific style for keyword chips that have been used */
        .keyword-chip.used {
            border-color: #EF4444 !important; /* Red border */
            background-color: #FEE2E2 !important; /* Light red background */
            color: #B91C1C !important; /* Darker red text */
            font-weight: 600;
            opacity: 0.7; /* Slightly dim it */
        }
        /* Style for selected keyword chips (for batch sending) */
        .keyword-chip.selected-for-batch {
            border-color: #22C55E !important; /* Green border */
            background-color: #DCFCE7 !important; /* Light green background */
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2) !important;
            font-weight: 600;
        }


        /* Prompt Chips */
        .prompt-chip-item {
            background-color: #FDFDFE; /* Light background */
            border: 1px solid #E5E7EB;
            border-radius: 0.75rem; /* Rounded corners */
            padding: 1rem 1.5rem; /* More padding */
            font-size: 0.95rem;
            transition: all 0.3s ease-in-out;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .prompt-chip-item.copied {
            background-color: #D1FAE5; /* Light green for flash */
            border-color: #10B981; /* Green border for flash */
            /* Animation handles the fade to .used state, or back to default if not used */
            animation: copiedFlash 0.5s ease-out forwards; /* Shorter flash animation */
        }

        /* Keyframe for the flash animation */
        @keyframes copiedFlash {
            from { background-color: #D1FAE5; border-color: #10B981; }
            to { background-color: #FDFDFE; border-color: #E5E7EB; } /* Fade back to default */
        }

        /* Permanent dimmed state for used prompts */
        .prompt-chip-item.used {
            background-color: #F3F4F6; /* Slightly darker than default, subtly dim */
            color: #9CA3AF; /* Muted text color */
            border-color: #E5E7EB; /* Default border */
            opacity: 0.8; /* Dim it further */
            /* pointer-events: none; /* Make it unclickable/unselectable after use, optional but good UX */ */
        }
        .prompt-chip-item.used .copy-prompt-btn {
            background-color: #CBD5E1; /* Muted button */
            cursor: not-allowed;
            pointer-events: none;
        }


        /* Inputs & Textareas */
        input[type="text"], textarea, select {
            border: 1px solid #D1D5DB; /* Light gray border */
            border-radius: 0.75rem; /* More rounded */
            padding: 0.8rem 1.2rem; /* Comfortable padding */
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.03); /* Subtle inner shadow */
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            border-color: #8B5CF6; /* Primary Accent (Indigo-500) */
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2), inset 0 1px 2px rgba(0,0,0,0.03); /* Soft accent ring */
            outline: none;
        }
        .prompt-keyword-input-used {
            border-color: #EF4444 !important; /* Red border for used keywords */
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
        }

        /* Sleek Buttons */
        .btn-primary {
            background: linear-gradient(to right, #8B5CF6, #7C3AED); /* Indigo gradient */
            color: white;
            font-weight: 600; /* Semi-bold */
            padding: 0.9rem 2.2rem; /* More generous padding */
            border-radius: 0.75rem; /* More rounded */
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.3); /* Softer, larger shadow */
            transition: all 0.3s ease-in-out;
            border: none; /* No ugly default border */
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            background: linear-gradient(to right, #7C3AED, #8B5CF6); /* Subtle gradient shift on hover */
        }
        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            background: #A78BFA; /* Lighter indigo when disabled */
        }

        .btn-secondary-red {
            background-color: #EF4444; /* Red */
            color: white;
            font-weight: 600;
            padding: 0.9rem 2.2rem;
            border-radius: 0.75rem;
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.2);
            transition: all 0.3s ease-in-out;
            border: none;
        }
        .btn-secondary-red:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
            background-color: #DC2626; /* Darker red */
        }
        .btn-secondary-red:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-copy {
            background-color: #A78BFA; /* Lighter Indigo */
            color: white;
            padding: 0.5rem 1rem; /* Slightly more padding */
            border-radius: 0.625rem; /* More rounded */
            font-size: 0.85rem;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out, transform 0.1s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .btn-copy:hover {
            background-color: #8B5CF6; /* Primary Indigo on hover */
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        /* Accordion styles (details/summary) - Enhanced */
        details {
            background-color: #F9FAFB; /* Match new light grey */
            border: 1px solid #E5E7EB;
            border-radius: 1rem; /* More rounded */
            margin-bottom: 1.25rem; /* More space */
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); /* Softer shadow */
            transition: all 0.3s ease-in-out;
            overflow: hidden; /* Ensure content respects border-radius */
        }

        details[open] {
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            background-color: #FFFFFF; /* White when open for clean contrast */
            border-color: #D1D5DB; /* Slightly darker border when open */
        }

        summary {
            font-weight: 600;
            color: #8B5CF6; /* Primary Accent (Indigo-500) */
            padding: 1.25rem 2rem; /* More padding */
            cursor: pointer;
            outline: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem; /* Slightly larger */
            user-select: none; /* Prevent text selection on click */
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::after {
            content: '\2b'; /* Plus sign Unicode */
            font-size: 1.8rem; /* Larger icon */
            color: #9CA3AF; /* Light gray for icon */
            font-weight: 400; /* Regular weight for icon */
            transition: transform 0.2s;
        }

        details[open] summary::after {
            content: '\2212'; /* Minus sign Unicode */
            transform: rotate(0deg);
        }

        .details-content {
            padding: 0 2rem 2rem; /* Consistent padding */
            color: #4B5563; /* Medium gray */
            font-size: 0.95rem;
        }
        .details-content ul {
            list-style: none; /* Remove default list style */
            padding-left: 0;
            margin-top: 0.75rem;
        }
        .details-content ul li {
            margin-bottom: 0.6rem; /* More space between list items */
            position: relative;
            padding-left: 1.8rem; /* Space for custom bullet */
        }
        .details-content ul li::before {
            content: '\2022'; /* Unicode bullet point */
            color: #8B5CF6; /* Primary Accent for bullets */
            position: absolute;
            left: 0.5rem; /* Adjust position */
            font-size: 1.2em;
            line-height: 1;
            top: 0.1em;
            font-weight: bold;
        }

        /* Message Box for Copy/Paste Instruction */
        .message-box {
            background-color: #10B981; /* Success green */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            font-weight: 500;
            font-size: 1rem;
            text-align: center;
            position: fixed;
            bottom: 25px; /* Slightly higher */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: none;
            animation: slideInUp 0.3s forwards, fadeOut 0.5s 3.5s forwards; /* Adjust timing */
            white-space: nowrap;
        }

        /* Footer CTA Specifics */
        .cta-section {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED); /* Stronger indigo gradient */
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }
        .cta-button {
            background-color: white;
            color: #8B5CF6;
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease-in-out;
        }
        .cta-button:hover {
            background-color: #F3F4F6;
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* Table specific styles for Save Data tab */
        #user-data-table th, #user-data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid #E5E7EB;
        }
        #user-data-table thead {
            background-color: #F9FAFB;
        }
        #user-data-table th {
            color: #4B5563;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        #user-data-table tbody tr:last-child td {
            border-bottom: none;
        }
    </style>
</head>
<body class="antialiased">

    <header class="app-header shadow-sm">
        <div class="container mx-auto px-4 py-6 text-center">
            <h1 class="text-4xl md:text-5xl font-black tracking-tighter text-gray-900">Pixel Profits AI</h1>
            <p class="text-lg md:text-xl font-semibold text-indigo-600">Your Blueprint for Stock Content Success</p>
        </div>
    </header>

    <nav id="main-nav" class="sticky top-0 bg-white/90 backdrop-blur-sm z-50 shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-center items-center text-gray-500 overflow-x-auto text-sm md:text-base">
                <button data-step="0" class="nav-btn active">Intro</button>
                <button data-step="1" class="nav-btn">Toolkit</button>
                <button data-step="2" class="nav-btn">Organic</button>
                <button data-step="3" class="nav-btn">AI Tools</button>
                <button data-step="4" class="nav-btn">Get Keywords</button>
                <button data-step="5" class="nav-btn">Prompt Generator</button>
                <button data-step="6" class="nav-btn">Save Data</button>
                <button data-step="7" class="nav-btn">Smart Tagging</button>
                <button data-step="8" class="nav-btn">Scale & Grow</button>
                <button data-step="9" class="nav-btn">Start Now</button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8">
        <!-- Intro -->
        <section id="step-content-0" class="step-content active fade-in">
            <div class="card-panel text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4 text-gray-800">Unlock Your Creative Income Potential.</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8">Your direct guide to earning with captivating visuals on Adobe Stock. Leverage cutting-edge AI for rapid, high-quality content creation and turn your ideas into a steady income stream.</p>
                <div class="grid md:grid-cols-3 gap-6 text-left">
                    <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-indigo-500 shadow-sm">
                        <h3 class="font-bold text-xl mb-2 text-gray-800">Passive Income</h3>
                        <p class="text-sm text-gray-600">Create once, earn 24/7. Your visuals become assets that work for you.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-indigo-500 shadow-sm">
                        <h3 class="font-bold text-xl mb-2 text-gray-800">AI-Powered Creation</h3>
                        <p class="text-sm text-gray-600">Generate stunning images efficiently, saving time and scaling your output effortlessly.</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl border-l-4 border-indigo-500 shadow-sm">
                        <h3 class="font-bold text-xl mb-2 text-gray-800">Global Marketplace</h3>
                        <p class="text-sm text-gray-600">Access millions of buyers worldwide directly through Adobe apps. Unmatched visibility.</p>
                    </div>
                </div>
                <div class="mt-10">
                     <img src="https://placehold.co/1000x400/E0E7FF/5B21B6?text=Creative+AI+Concepts" alt="Abstract AI creative process" class="w-full h-auto rounded-xl shadow-lg">
                </div>
            </div>
        </section>

        <!-- Step 1: Toolkit & Setup -->
        <section id="step-content-1" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">1. Essential Toolkit & Setup</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Gather your basic gear and set up your Adobe Stock account. You likely have most of what you need already!</p>
                <div class="grid md:grid-cols-2 gap-8 items-start">
                    <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                        <h3 class="font-bold text-xl mb-4 text-indigo-600">Your Gear</h3>
                        <ul class="space-y-3 text-base text-gray-700">
                            <li class="flex items-center"><span class="text-indigo-600 font-bold text-xl mr-2">&#x2726;</span><div><b>Device:</b> Laptop, phone, or camera.</div></li>
                            <li class="flex items-center"><span class="text-indigo-600 font-bold text-xl mr-2">&#x2726;</span><div><b>Internet:</b> Reliable connection for uploads.</div></li>
                            <li class="flex items-center"><span class="text-indigo-600 font-bold text-xl mr-2">&#x2726;</span><div><b>Keen Eye:</b> Intuition for marketable visuals.</div></li>
                            <li class="flex items-center"><span class="text-indigo-600 font-bold text-xl mr-2">&#x2726;</span><div><b>Dedication:</b> 2 hours daily, consistently.</div></li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                        <h3 class="font-bold text-xl mb-4 text-indigo-600">Quick Setup</h3>
                           <ol class="list-decimal list-inside space-y-3 text-base text-gray-700">
                                <li><b>Sign Up:</b> Visit <a href="https://contributor.stock.adobe.com/en?isa0=1" target="_blank" class="font-semibold text-indigo-600 hover:underline">Adobe Stock Contributor</a>.</li>
                                <li><b>Verify:</b> Complete ID & tax info for payouts.</li>
                                <li><b>Go Live:</b> Account active! Adobe handles sales.</li>
                            </ol>
                            <p class="text-sm text-amber-700 mt-4">Pro Tip: Double-check country of residence during sign-up.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Step 2: Organic Content Creation -->
        <section id="step-content-2" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">2. Organic Content Creation</h2>
                <p class="max-w_3xl mx-auto text-gray-600 text-lg mb-8 text-center">Unique photos & videos offer authenticity. Focus on quality, composition, and trending subjects.</p>
                
                <div class="space-y-4">
                    <details class="rounded-xl overflow-hidden">
                        <summary>Key Niches for Organic Content</summary>
                        <div class="details-content">
                            <p class="text-sm text-gray-700 mb-3">Focus on themes with consistent buyer demand:</p>
                            <ul>
                                <li>Authentic Lifestyle: Real, unposed human moments, diverse groups, remote work, mental wellness.</li>
                                <li>Modern Tech Use: People interacting with devices, clean interfaces, innovative tech concepts.</li>
                                <li>Diversity & Inclusion: Genuinely representing various ages, ethnicities, body types, and abilities.</li>
                                <li>Conceptual Imagery: Visually representing abstract ideas like "growth," "connection," "innovation."</li>
                                <li>Vertical Video: Short, engaging, and well-lit clips optimized for social media stories and reels.</li>
                                <li>Sustainable Living: Eco-conscious practices, recycling, urban gardening, renewable energy.</li>
                                <li>Remote Work Productivity: Beyond desk setups – work from cafes, parks, travel.</li>
                                <li>Authentic Mental Wellness: Self-care, mindfulness, digital detox.</li>
                                <li>Generational Collaboration: Multiple generations interacting naturally in various settings.</li>
                                <li>Digital Nomads/Van Life: Freedom, minimalist lifestyle, connectivity on the go.</li>
                            </ul>
                        </div>
                    </details>

                    <details class="rounded-xl overflow-hidden">
                        <summary>Quality First Principles</summary>
                        <div class="details-content">
                            <p class="text-sm text-gray-700 mb-3">Ensure your content meets high standards:</p>
                            <ul>
                                <li>Sharpness & Focus: No blur.</li>
                                <li>Lighting: Natural light often best.</li>
                                <li>Composition: Frame well, leave "copy space."</li>
                                <li>Cleanliness: No logos/trademarks.</li>
                                <li>Technical Specs: Meet 4MP minimum.</li>
                            </ul>
                        </div>
                    </details>

                    <details class="rounded-xl overflow-hidden">
                        <summary>Legal Musts: Releases</summary>
                        <div class="details-content">
                            <p class="text-sm text-gray-700 mb-3">Critical for commercial use:</p>
                            <ul>
                                <li>Model Releases: MANDATORY for recognizable people.</li>
                                <li>Property Releases: REQUIRED for private property.</li>
                            </ul>
                            <p class="text-xs text-amber-700 mt-2">Missing releases = rejection. Always secure them!</p>
                        </div>
                    </details>
                </div>
                <p class="mt-8 p-4 bg-emerald-50 rounded-lg border border-emerald-200 font-bold text-emerald-800 text-sm">Action: Practice! Shoot 5-10 high-quality concepts today. Focus on composition & lighting.</p>
            </div>
        </section>
        
        <!-- Step 3: AI Tools Overview -->
        <section id="step-content-3" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">3. AI Tools Unleashed</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">AI tools empower you to create stunning, unique stock images at scale. Focus on efficiency and leveraging AI for maximum output.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 items-start">
                    <!-- New visual-driven content for AI Tools -->
                    <div class="p-6 rounded-xl bg-gray-50 shadow-sm flex flex-col items-center text-center">
                        <img src="https://placehold.co/150x100/E0E7FF/5B21B6?text=AI+Efficiency" alt="AI for Efficiency" class="mb-4 rounded-lg shadow-md">
                        <h3 class="font-bold text-xl mb-2 text-indigo-600">Boost Efficiency</h3>
                        <p class="text-sm text-gray-700">Automate repetitive tasks and accelerate content creation.</p>
                    </div>
                    <div class="p-6 rounded-xl bg-gray-50 shadow-sm flex flex-col items-center text-center">
                        <img src="https://placehold.co/150x100/E0E7FF/5B21B6?text=Global+Reach" alt="AI for Global Reach" class="mb-4 rounded-lg shadow-md">
                        <h3 class="font-bold text-xl mb-2 text-indigo-600">Expand Reach</h3>
                        <p class="text-sm text-gray-700">Generate diverse content appealing to global markets.</p>
                    </div>
                    <div class="p-6 rounded-xl bg-gray-50 shadow-sm flex flex-col items-center text-center">
                        <img src="https://placehold.co/150x100/E0E7FF/5B21B6?text=Innovation" alt="AI for Innovation" class="mb-4 rounded-lg shadow-md">
                        <h3 class="font-bold text-xl mb-2 text-indigo-600">Fuel Innovation</h3>
                        <p class="text-sm text-gray-700">Explore new creative concepts and visual styles rapidly.</p>
                    </div>
                    <div class="md:col-span-3 mt-10">
                         <img src="https://placehold.co/1000x400/E0E7FF/5B21B6?text=Unlock+AI+Potential" alt="AI tools overview" class="w-full h-auto rounded-xl shadow-lg">
                    </div>
                </div>
                <p class="mt-8 p-4 bg-emerald-50 rounded-lg border border-emerald-200 font-bold text-emerald-800 text-sm">Key: Image quality depends on your prompt. Learn to craft perfect prompts here!</p>
            </div>
        </section>

        <!-- Step 4: Get Keywords -->
        <section id="step-content-4" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">4. Get Keywords</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Pinpoint high-demand niches and grab relevant keywords. Explore categories, then dive into specific content opportunities.</p>
                
                <!-- Stage 1: Niche Category Selection & Generation -->
                <div id="niche-generation-section" class="bg-gray-50 p-6 rounded-xl border shadow-sm mb-8">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Stage 1: Discover Unique Niches</h3>
                    <p class="text-sm text-center text-gray-700 mb-4">Select a category. Our AI generates 15-20 specific, low-competition niches. Click any niche card to automatically grab 100 keywords for it below!</p>
                    <div class="max-w-md mx-auto space-y-3">
                        <select id="niche-category-select" class="w-full p-2 border border-gray-300 rounded-xl focus:ring-indigo-600 focus:border-indigo-600">
                            <option value="">-- Select a Niche Category --</option>
                            <option value="Emerging Technologies">Emerging Technologies</option>
                            <option value="Subculture & Niche Lifestyles">Subculture & Niche Lifestyles</option>
                            <option value="Future of Work & Education">Future of Work & Education</option>
                            <option value="Abstract & Conceptual Visuals">Abstract & Conceptual Visuals</option>
                            <option value="Sustainable & Eco-Conscious Living">Sustainable & Eco-Conscious Living</option>
                            <option value="Authentic Diversity & Inclusivity">Authentic Diversity & Inclusivity</option>
                            <option value="Micro-moments & Everyday Life">Micro-moments & Everyday Life</option>
                            <option value="Global Cultural Celebrations (Untraditional)">Global Cultural Celebrations (Untraditional)</option>
                            <option value="Health & Wellness Beyond Fitness">Health & Wellness Beyond Fitness</option>
                            <option value="AI & Robotics in Daily Life">AI & Robotics in Daily Life</option>
                            <option value="Urban Exploration & Architecture Details">Urban Exploration & Architecture Details</option>
                            <option value="Mindful Living & Digital Detox">Mindful Living & Digital Detox</m-step>
                            <option value="Sensory Experiences (Texture, Sound Vis.)">Sensory Experiences (Texture, Sound Vis.)</option>
                            <option value="Retro Futurism & Nostalgia">Retro Futurism & Nostalgia</option>
                            <option value="Financial Literacy & Investing (Visualized)">Financial Literacy & Investing (Visualized)</option>
                            <option value="Community Building & Local Events">Community Building & Local Events</option>
                            <option value="Home Automation & Smart Living">Home Automation & Smart Living</option>
                            <option value="Artisanal Crafts & Handmade Goods">Artisanal Crafts & Handmade Goods</option>
                            <option value="Space Exploration & Astronomy (Conceptual)">Space Exploration & Astronomy (Conceptual)</option>
                            <option value="Generational Dynamics (Specific Interactions)">Generational Dynamics (Specific Interactions)</option>
                        </select>
                        <button id="generate-niches-btn" class="w-full btn-primary">Generate Niches</button>
                        <button id="clear-niche-generator-history-btn" class="w-full btn-secondary-red text-sm">Clear Niche History</button>
                    </div>
                    
                    <div id="niche-generator-loading" class="hidden loading-spinner"></div>
                    <div id="niche-generator-error" class="hidden mt-4 text-center text-red-600 font-semibold"></div>
                    <div id="niche-generator-output" class="mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 text-sm max-h-96 overflow-y-auto p-2 border border-gray-200 rounded-xl bg-white">
                        <!-- Generated niches will appear here -->
                    </div>
                    <p class="text-xs text-gray-500 mt-4 text-center">Note: New niches are unique per category session. Click a niche to get its keywords!</p>
                </div>

                <!-- Stage 2: Keyword Generation for Selected Niche -->
                <div id="keyword-generation-section" class="bg-gray-50 p-6 rounded-xl border shadow-sm hidden">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Stage 2: Keywords for <b id="selected-niche-display" class="text-indigo-700"></b></h3>
                    <p class="text-sm text-center text-gray-700 mb-4">Here are 100 high-demand keywords generated for your selected niche. Click any keyword to automatically populate it in the 'Prompt Generator' section (Step 5)!</p>
                    
                    <button id="clear-subniche-keywords-btn" class="w-full btn-secondary-red text-sm max-w-md mx-auto block">Clear Keywords History</button>
                    
                    <div id="keyword-grabber-loading" class="hidden loading-spinner"></div>
                    <div id="keyword-grabber-error" class="hidden mt-4 text-center text-red-600 font-semibold"></div>
                    <div id="keyword-grabber-output" class="mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2 text-sm max-h-96 overflow-y-auto p-2 border border-gray-200 rounded-xl bg-white">
                        <!-- Keywords will appear here -->
                    </div>
                    <p class="text-xs text-gray-500 mt-4 text-center">Pro Tip: Click any keyword to select for batch transfer, or click to copy to single prompt generator!</p>
                    
                    <!-- Button to send selected keywords to batch generator -->
                    <button id="send-keywords-to-batch-btn" class="w-full btn-primary mt-6 hidden">Send Selected to Batch Prompts</button>

                </div>
            </div>
        </section>

        <!-- Step 5: Prompt Generator -->
        <section id="step-content-5" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">5. Prompt Generator</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Turn a simple keyword into a powerful AI command. A well-crafted prompt ensures you get exact image quality for Adobe Stock. Generate 10 unique prompts from a single keyword.</p>
                
                <div class="bg-gray-50 p-6 rounded-xl border shadow-sm mb-8">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Single Prompt Generation:</h3>
                    <p class="text-sm text-center text-gray-700 mb-4">Enter a keyword (e.g., "startup team", "forest stream"). Our AI generates 10 unique prompts based on your chosen length. Click any generated prompt to copy!</p>
                    <div class="flex flex-col sm:flex-row items-center gap-4 max-w-xl mx-auto mb-4">
                        <input type="text" id="prompt-keyword-input" placeholder="Enter keyword (e.g., 'German dog')" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-600 focus:border-indigo-600">
                        <select id="prompt-length-select" class="p-2 border border-gray-300 rounded-xl focus:ring-indigo-600 focus:border-indigo-600 w-full sm:w-auto">
                            <option value="medium">Medium Prompts</option>
                            <option value="short">Short Prompts</option>
                            <option value="long">Long Prompts</option>
                        </select>
                        <button id="generate-prompts-btn" class="w-full sm:w-auto btn-primary whitespace-nowrap">Generate 10 Prompts</button>
                    </div>
                    <p id="prompt-keyword-history-note" class="text-xs text-orange-600 mt-2 hidden text-center">Note: This keyword has been used before.</p>
                    <button id="clear-prompt-keywords-btn" class="w-full btn-secondary-red text-sm max-w-xl mx-auto block">Clear Prompt History</button>
                    
                    <div id="prompts-loading" class="hidden loading-spinner"></div>
                    <div id="prompts-error" class="hidden mt-4 text-center text-red-600 font-semibold"></div>
                    <div id="prompts-output" class="mt-6 space-y-4 text-base bg-white p-4 rounded-xl border max-h-96 overflow-y-auto">
                        <!-- Prompts will appear here -->
                    </div>
                    <div id="prompt-copy-message" class="message-box">Prompt copied!</div>
                </div>

                <!-- Batch Prompt Generator Section (inside Prompt Generator) -->
                <div class="bg-gray-50 p-6 rounded-xl border shadow-sm mt-10">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Batch Prompt Generator:</h3>
                    <p class="text-sm text-center text-gray-700 mb-4">Enter 1 to 100 keywords (one per line or comma-separated). Generate 10 prompts per keyword, then view them below.</p>
                    <div class="flex flex-col gap-4 max-w-xl mx-auto mb-4">
                        <textarea id="batch-keywords-input" rows="5" placeholder="Enter keywords (e.g., &#10;keyword1, keyword2 &#10;keyword3)" class="w-full px-4 py-2 border border-gray-300 rounded-xl focus:ring-indigo-600 focus:border-indigo-600 resize-y"></textarea>
                        <select id="batch-prompt-length-select" class="p-2 border border-gray-300 rounded-xl focus:ring-indigo-600 focus:border-indigo-600 w-full">
                            <option value="medium">Medium Prompts</option>
                            <option value="short">Short Prompts</option>
                            <option value="long">Long Prompts</option>
                        </select>
                        <button id="generate-batch-prompts-btn" class="w-full btn-primary">Generate Batch Prompts</button>
                    </div>
                    <div id="batch-prompts-loading" class="hidden loading-spinner"></div>
                    <div id="batch-prompts-error" class="hidden mt-4 text-center text-red-600 font-semibold"></div>

                    <!-- Batch prompts output section (moved here from a separate tab) -->
                    <div id="batch-prompts-output-display" class="mt-6 space-y-6 text-base bg-white p-4 rounded-xl border max-h-96 overflow-y-auto">
                        <p class="text-gray-500 text-center">Generated batch prompts will appear here.</p>
                    </div>
                    <button id="clear-batch-prompts-btn" class="w-full btn-secondary-red text-sm max-w-xl mx-auto block mt-6">Clear Batch Prompts</button>
                </div>

                <p class="mt-8 p-4 bg-emerald-50 rounded-lg border border-emerald-200 font-bold text-emerald-800 text-sm">Pro Tip: Good prompts include: Subject + Action + Setting + Style + Technical Details (e.g., 8K, white background). Aim for clarity and detail!</p>
            </div>
        </section>

        <!-- Step 6: Save Data -->
        <section id="step-content-6" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">6. Save & Export Your Data</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Track your discovered niches, keywords, and copied prompts. Export your data to a CSV file for analysis or import into a Google Sheet.</p>
                
                <div class="bg-gray-50 p-6 rounded-xl border shadow-sm">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Your Collected Data</h3>
                    <div id="collected-data-output" class="mb-6 bg-white p-4 rounded-xl border overflow-auto max-h-96">
                        <!-- Data will be dynamically loaded here -->
                        <p class="text-gray-500 text-center">No data collected yet. Start exploring niches and copying prompts!</p>
                    </div>
                    <button id="export-collected-data-btn" class="w-full btn-primary">Export Data to CSV</button>
                    <p class="text-xs text-amber-700 mt-4 text-center">
                        <b>Important:</b> Direct saving to Google Sheets from a client-side application is not securely feasible without a backend for OAuth authentication. Click "Export Data to CSV", then manually import the CSV into your Google Sheet.
                    </p>
                </div>
            </div>
        </section>

        <!-- Step 7: Smart Tagging & Export -->
        <section id="step-content-7" class="step-content fade-in">
            <div class="card-panel">
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">7. Smart Tagging & Export</h2>
                <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Boost efficiency with AI-powered metadata. Upload images in batch, let Gemini analyze, and export titles & tags ready for Adobe Stock.</p>
                
                <div class="bg-gray-50 p-6 rounded-xl border shadow-sm mb-6">
                    <h3 class="font-bold text-xl mb-4 text-center text-indigo-600">Batch Image Metadata Generator</h3>
                    <p class="text-sm text-center text-gray-700 mb-4">Upload your images (up to 200). Our AI will analyze them and suggest titles & tags.</p>
                    
                    <input type="file" id="image-upload-input" accept="image/jpeg, image/png" multiple class="w-full text-sm text-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 mb-4">
                    <p id="upload-status" class="text-center text-gray-500 text-sm mb-4"></p>

                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-6 p-4 bg-white rounded-xl border shadow-sm">
                        <div class="flex items-center space-x-2 w-full sm:w-auto">
                            <label for="title-length-slider" class="text-sm font-medium text-gray-700 whitespace-nowrap">Title Length:</label>
                            <input type="range" id="title-length-slider" min="60" max="180" value="100" class="w-full accent-indigo-600">
                            <span id="title-length-value" class="text-sm font-bold text-indigo-700 w-12 text-right">100</span>
                        </div>
                        <div class="flex items-center space-x-2 w-full sm:w-auto">
                            <label for="tags-limit-slider" class="text-sm font-medium text-gray-700 whitespace-nowrap">Tags Count:</label>
                            <input type="range" id="tags-limit-slider" min="0" max="49" value="30" class="w-full accent-indigo-600">
                            <span id="tags-limit-value" class="text-sm font-bold text-indigo-700 w-12 text-right">30</span>
                        </div>
                        <div class="flex items-center w-full sm:w-auto">
                            <input type="checkbox" id="transparent-background-toggle" class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out rounded focus:ring-indigo-500">
                            <label for="transparent-background-toggle" class="ml-2 block text-sm text-gray-700 whitespace-nowrap">Add "transparent background"</label>
                        </div>
                    </div>
                    
                    <button id="analyze-images-btn" class="w-full btn-primary">Analyze & Generate Metadata</button>
                    
                    <div id="metadata-loading" class="hidden loading-spinner"></div>
                    <div id="metadata-error" class="hidden mt-4 text-center text-red-600 font-semibold"></div>
                    
                    <div id="image-previews-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-6 max-h-64 overflow-y-auto p-2 border border-gray-200 rounded-xl bg-white">
                        <!-- Image previews will go here -->
                    </div>

                    <div id="metadata-results-container" class="mt-6 hidden">
                        <h4 class="font-bold text-lg mb-3 text-center text-indigo-600">Generated Metadata (Ready for CSV)</h4>
                        <div class="bg-white p-4 rounded-xl border max-h-96 overflow-y-auto">
                            <table class="min-w-full text-sm divide-y divide-gray-200" id="metadata-table">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <th class="px-2 py-2 text-left text-gray-600 font-semibold">Image</th>
                                                                                <th class="px-2 py-2 text-left text-gray-600 font-semibold">Title</th>
                                        <th class="px-2 py-2 text-left text-gray-600 font-semibold">Keywords</th>
                                    </tr>
                                </thead>
                                <tbody id="metadata-table-body" class="divide-y divide-gray-200">
                                    <!-- Metadata rows will be injected here -->
                                </tbody>
                            </table>
                        </div>
                        <button id="export-csv-btn" class="w-full btn-primary mt-6 bg-gradient-to-r from-emerald-500 to-emerald-700 hover:from-emerald-700 hover:to-emerald-500 hover:shadow-xl">Export to CSV</button>
                    </div>
                </div>
            </div>
        </section>

            <!-- Step 8: Analyze & Scale -->
            <section id="step-content-8" class="step-content fade-in">
                <div class="card-panel">
                    <h2 class="text-3xl md:text-4xl font-bold mb-6 text-center text-gray-800">8. Analyze, Adapt & Scale</h2>
                    <p class="max-w-3xl mx-auto text-gray-600 text-lg mb-8 text-center">Monitor performance, learn from data, and strategically scale your portfolio for long-term income growth. Optimize your profit machine!</p>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-2 text-center text-indigo-600">Illustrative Earnings</h3>
                            <p class="text-sm text-gray-600 mb-4 text-center">Consistent uploads lead to exponential growth. This chart shows a typical trajectory.</p>
                            <div class="chart-container">
                                <canvas id="growthChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-2 text-center text-indigo-600">Portfolio Mix</h3>
                            <p class="text-sm text-gray-600 mb-4 text-center">Diversify content types to tap more buyer segments and maximize earnings.</p>
                            <div class="chart-container">
                                <canvas id="mixChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-2 text-indigo-600">Analyze & Adapt: Your Dashboard is Gold</h3>
                            <ul class="list-disc list-inside text-base text-gray-700 space-y-2">
                                <li><b>Monitor Sales:</b> Regularly check your Adobe Stock Contributor dashboard. See what sells best.</li>
                                <li><b>Create More:</b> Double down on best-performing content categories.</li>
                                <li><b>Learn:</b> Use rejection feedback to improve.</li>
                            </ul>
                        </div>
                        <div class="bg-gray-50 p-6 rounded-xl shadow-sm">
                            <h3 class="font-bold text-lg mb-2 text-indigo-600">Reinvest & Stay Current: Future-Proof Income</h3>
                            <ul class="list-disc list-inside text-base text-gray-700 space-y-2">
                                <li><b>Smart Reinvestment:</b> Use earnings to upgrade AI subscriptions, software, or advanced courses.</li>
                                
                                <li><b>Stay Savvy:</b> Follow market trends & new tech.</li>
                                <li><b>Consistency:</b> Regular uploads build long-term income.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 9: Final CTA -->
            <section id="step-content-9" class="step-content fade-in">
                <div class="cta-section text-white p-8 md:p-12 rounded-xl shadow-lg text-center">
                    <h2 class="text-3xl md:text-4xl font-black mb-4">Your Money Move. Today.</h2>
                    <p class="text-lg text-indigo-100 max-w-2xl mx-auto mb-8">You have the blueprint to monetize stunning visuals on Adobe Stock, with AI power. Stop waiting! Build your flexible income stream now.</p>
                    <a href="https://contributor.stock.adobe.com/en?isa0=1" target="_blank" class="inline-block cta-button">
                        Start Your Adobe Stock Journey Now!
                    </a>
                </div>
            </section>
        </main>
    </div> <!-- End of main-app-content -->

    <!-- Message Box for Copy/Paste Instruction -->
    <div id="prompt-copy-message" class="message-box">Prompt copied!</div>
    <div id="custom-alert-message" class="message-box" style="background-color: #EF4444;"></div>


    <script>
        // --- IMPORTANT: Configure your Gemini API Key directly here ---
        // This key will be visible in your app's code. Use with caution for public apps.
        // Get your key from: https://aistudio.google.com/app/apikey
        const GEMINI_API_KEY = "AIzaSyB5nnpO3T2yh4id5ErSKNW5dee6FlzgraQ"; // <<< REPLACE THIS WITH YOUR ACTUAL KEY!

        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References (Declared once at the very top of DOMContentLoaded) ---
            const navButtons = document.querySelectorAll('.nav-btn');
            const stepContents = document.querySelectorAll('.step-content');
            const customAlertMessageBox = document.getElementById('custom-alert-message');
            
            // Get Keywords Tab Elements
            const nicheCategorySelect = document.getElementById('niche-category-select');
            const generateNichesBtn = document.getElementById('generate-niches-btn');
            const nicheGeneratorOutput = document.getElementById('niche-generator-output');
            const nicheGeneratorLoading = document.getElementById('niche-generator-loading');
            const nicheGeneratorError = document.getElementById('niche-generator-error');
            const clearNicheGeneratorHistoryBtn = document.getElementById('clear-niche-generator-history-btn');
            const keywordGenerationSection = document.getElementById('keyword-generation-section');
            const selectedNicheDisplay = document.getElementById('selected-niche-display');
            const keywordGrabberOutput = document.getElementById('keyword-grabber-output');
            const keywordGrabberLoading = document.getElementById('keyword-grabber-loading');
            const keywordGrabberError = document.getElementById('keyword-grabber-error');
            const clearSubNicheKeywordsBtn = document.getElementById('clear-subniche-keywords-btn');
            const sendKeywordsToBatchBtn = document.getElementById('send-keywords-to-batch-btn'); 

            // Prompt Generator Tab Elements
            const promptKeywordInput = document.getElementById('prompt-keyword-input');
            const generatePromptsBtn = document.getElementById('generate-prompts-btn');
            const promptsOutput = document.getElementById('prompts-output');
            const promptsLoading = document.getElementById('prompts-loading');
            const promptsError = document.getElementById('prompts-error');
            const promptKeywordHistoryNote = document.getElementById('prompt-keyword-history-note');
            const clearPromptKeywordsBtn = document.getElementById('clear-prompt-keywords-btn');
            const promptCopyMessage = document.getElementById('prompt-copy-message');
            const promptLengthSelect = document.getElementById('prompt-length-select');
            
            // Batch Prompt Generator Elements (within Prompt Generator tab)
            const batchKeywordsInput = document.getElementById('batch-keywords-input');
            const batchPromptLengthSelect = document.getElementById('batch-prompt-length-select');
            const generateBatchPromptsBtn = document.getElementById('generate-batch-prompts-btn');
            const batchPromptsLoading = document.getElementById('batch-prompts-loading');
            const batchPromptsError = document.getElementById('batch-prompts-error');
            const batchPromptsOutputDisplayDiv = document.getElementById('batch-prompts-output-display'); 
            const clearBatchPromptsBtn = document.getElementById('clear-batch-prompts-btn');


            // Save Data Tab Elements
            const exportCollectedDataBtn = document.getElementById('export-collected-data-btn');

            // Smart Tagging & Export Tab Elements
            const imageUploadInput = document.getElementById('image-upload-input');
            const uploadStatus = document.getElementById('upload-status');
            const analyzeImagesBtn = document.getElementById('analyze-images-btn');
            const metadataLoading = document.getElementById('metadata-loading');
            const metadataError = document.getElementById('metadata-error');
            const imagePreviewsContainer = document.getElementById('image-previews-container');
            const metadataResultsContainer = document.getElementById('metadata-results-container');
            const metadataTableBody = document.getElementById('metadata-table-body');
            const exportCsvBtn = document.getElementById('export-csv-btn');
            const titleLengthSlider = document.getElementById('title-length-slider');
            const titleLengthValue = document.getElementById('title-length-value');
            const tagsLimitSlider = document.getElementById('tags-limit-slider');
            const tagsLimitValue = document.getElementById('tags-limit-value');
            const transparentBackgroundToggle = document.getElementById('transparent-background-toggle');


            // --- Global Data Storage for Save Data Tab & Feature Logic ---
            let userData = {
                nicheCategory: '',
                selectedSubNiche: '',
                generatedKeywords: [],
                copiedPrompts: [], // For single prompt gen: { text: "...", used: true/false }
                batchPrompts: [] // For batch gen: { keyword: "...", prompts: [{ text: "...", used: true/false }] }
            };

            // --- Tracking selected keywords for batch transfer from Get Keywords tab ---
            let currentlySelectedKeywordChips = []; // Keep track of selected chips


            // --- Utility Functions ---

            // History Management Functions (adapted for userData)
            const getHistory = (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key)) || [];
                } catch (e) {
                    console.error('Error parsing localStorage for key', key, e);
                    return [];
                }
            };

            const saveHistory = (key, history) => {
                localStorage.setItem(key, JSON.stringify(history));
            };

            const addEntryToHistory = (key, entry) => {
                let history = getHistory(key);
                const lowerCaseEntry = typeof entry === 'string' ? entry.toLowerCase() : entry; 

                if (!history.includes(lowerCaseEntry)) {
                    history.push(lowerCaseEntry);
                    saveHistory(key, history);
                }
            };

            const isEntryInHistory = (key, entry) => {
                const history = getHistory(key);
                const lowerCaseEntry = typeof entry === 'string' ? entry.toLowerCase() : entry;
                return history.includes(lowerCaseEntry);
            };

            const clearHistory = (key) => {
                localStorage.removeItem(key);
            };

            // Copy to Clipboard with Fallback
            const copyToClipboard = async (text, messageBoxElement) => {
                try {
                    await navigator.clipboard.writeText(text);
                    displayMessageBox(messageBoxElement, 'Prompt copied!', '#10B981');
                } catch (err) {
                    const textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.style.position = 'fixed';
                    textarea.style.left = '-9999px';
                    document.body.appendChild(textarea);
                    textarea.select();
                    try {
                        document.execCommand('copy');
                        displayMessageBox(messageBoxElement, 'Prompt copied!', '#10B981');
                    } catch (execErr) {
                        displayMessageBox(messageBoxElement, 'Failed to copy. Copy manually.', '#EF4444');
                    } finally {
                        document.body.removeChild(textarea);
                    }
                }
            };

            // Display Message Box
            const displayMessageBox = (element, message, bgColor) => {
                element.textContent = message;
                element.style.backgroundColor = bgColor;
                element.style.display = 'block';
                element.classList.remove('fadeOut');
                element.classList.add('slideInUp');
                setTimeout(() => {
                    element.classList.remove('slideInUp');
                    element.classList.add('fadeOut');
                }, 4000);
            };

            // Render User Data in Save Data Tab
            const renderUserData = () => {
                const collectedDataOutput = document.getElementById('collected-data-output');
                let html = '';

                if (userData.nicheCategory || userData.selectedSubNiche || userData.generatedKeywords.length > 0 || userData.copiedPrompts.length > 0 || userData.batchPrompts.length > 0) {
                    html += `
                        <div class="mb-4">
                            <h4 class="font-semibold text-lg text-gray-700 mb-2">Current Session Data:</h4>
                            <p class="text-gray-600 text-sm mb-1"><strong>Niche Category:</strong> ${userData.nicheCategory || 'N/A'}</p>
                            <p class="text-gray-600 text-sm mb-1"><strong>Selected Sub-Niche:</strong> ${userData.selectedSubNiche || 'N/A'}</p>
                            <p class="text-gray-600 text-sm mb-1"><strong>Generated Keywords:</strong> ${userData.generatedKeywords.join(', ') || 'N/A'}</p>
                        </div>
                    `;

                    if (userData.copiedPrompts.length > 0) {
                        html += `
                            <h4 class="font-semibold text-lg text-gray-700 mb-2">Copied Prompts (Single Generation):</h4>
                            <div class="bg-white p-4 rounded-xl border max-h-64 overflow-y-auto mb-4">
                                <table class="min-w-full text-sm" id="user-data-table">
                                    <thead>
                                        <tr>
                                            <th>Prompt</th>
                                            <th>Used</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        userData.copiedPrompts.forEach(p => {
                            html += `
                                <tr>
                                    <td class="text-gray-700">${p.text}</td>
                                    <td class="text-center">${p.used ? '<span class="text-emerald-600">&#10003;</span>' : '<span class="text-red-600">&#x2717;</span>'}</td>
                                </tr>
                            `;
                        });
                        html += `
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }

                    if (userData.batchPrompts.length > 0) {
                        html += `
                            <h4 class="font-semibold text-lg text-gray-700 mb-2">Batch Generated Prompts:</h4>
                            <div class="bg-white p-4 rounded-xl border max-h-64 overflow-y-auto">
                        `;
                        userData.batchPrompts.forEach(batchEntry => {
                            html += `<p class="font-medium text-indigo-600 mt-3 mb-2"><b>Keyword:</b> ${batchEntry.keyword}</p>`;
                            html += `<table class="min-w-full text-sm mb-3"><thead><tr><th>Prompt</th><th>Used</th></tr></thead><tbody>`;
                            batchEntry.prompts.forEach(p => {
                                html += `
                                    <tr>
                                        <td class="text-gray-700">${p.text}</td>
                                        <td class="text-center">${p.used ? '<span class="text-emerald-600">&#10003;</span>' : '<span class="text-red-600">&#x2717;</span>'}</td>
                                    </tr>
                                `;
                            });
                            html += `</tbody></table>`;
                        });
                        html += `</div>`;
                    }

                } else {
                    html = '<p class="text-gray-500 text-center">No data collected yet. Start exploring niches and copying prompts!</p>';
                }
                collectedDataOutput.innerHTML = html;
            };

            // Render Batch Prompts Output (within Prompt Generator tab)
            const renderBatchPromptsOutput = () => {
                let html = '';
                if (userData.batchPrompts.length === 0) {
                    html = '<p class="text-gray-500 text-center">Generated batch prompts will appear here.</p>';
                } else {
                    userData.batchPrompts.forEach((batchEntry, batchIndex) => {
                        html += `
                            <div class="bg-white p-4 rounded-xl border shadow-sm mb-6">
                                <h4 class="font-bold text-lg text-indigo-600 mb-3">Keyword: ${batchEntry.keyword}</h4>
                                <div class="space-y-4 text-base">
                        `;
                        batchEntry.prompts.forEach((p, promptIndex) => {
                            const isPromptUsed = p.used;
                            html += `
                                    <div class="prompt-chip-item bg-gray-50 p-3 rounded-xl border text-sm flex justify-between items-center ${isPromptUsed ? 'used' : ''}" data-batch-index="${batchIndex}" data-prompt-index="${promptIndex}">
                                        <span class="flex-grow mr-2">${p.text}</span>
                                        <button class="copy-prompt-btn bg-indigo-500 text-white text-xs font-semibold px-3 py-1 rounded-md hover:bg-indigo-600 transition">Copy</button>
                                    </div>
                            `;
                        });
                        html += `
                                </div>
                            </div>
                        `;
                    });
                }
                batchPromptsOutputDisplayDiv.innerHTML = html;

                // Attach event listeners to newly rendered copy buttons in batch output
                document.querySelectorAll('#batch-prompts-output-display .copy-prompt-btn').forEach(button => {
                    button.addEventListener('click', async (p_event) => {
                        const promptTextElement = p_event.currentTarget.previousElementSibling;
                        const promptText = promptTextElement.textContent;
                        const parentItem = p_event.currentTarget.closest('.prompt-chip-item');
                        const batchIndex = parseInt(parentItem.getAttribute('data-batch-index'));
                        const promptIndex = parseInt(parentItem.getAttribute('data-prompt-index'));

                        if (parentItem) {
                            parentItem.classList.remove('copied');
                            void parentItem.offsetWidth; 
                        }

                        await copyToClipboard(promptText, customAlertMessageBox);

                        if (parentItem) {
                            parentItem.classList.add('copied');
                            setTimeout(() => {
                                parentItem.classList.add('used');
                            }, 500);
                        }

                        if (userData.batchPrompts[batchIndex] && userData.batchPrompts[batchIndex].prompts[promptIndex]) {
                            userData.batchPrompts[batchIndex].prompts[promptIndex].used = true;
                        }
                    });
                });
            };


            // --- Main Navigation Logic ---
            const navigateToStep = (stepIndex) => {
                // Deactivate all nav buttons and content sections
                navButtons.forEach(btn => btn.classList.remove('active'));
                stepContents.forEach(content => content.classList.remove('active', 'fade-in'));

                // Activate the target nav button
                const targetNavButton = document.querySelector(`button[data-step="${stepIndex}"]`);
                if (targetNavButton) {
                    targetNavButton.classList.add('active');
                }

                // Activate the target content section
                const targetContentSection = document.getElementById(`step-content-${stepIndex}`);
                if (targetContentSection) {
                    targetContentSection.classList.add('active');
                    setTimeout(() => targetContentSection.classList.add('fade-in'), 10);
                    targetContentSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                // Special handling for content rendering when navigating to specific tabs
                if (stepIndex === 5) { // Prompt Generator tab (which now also displays batch output)
                    renderBatchPromptsOutput(); // Ensure batch output is updated
                } else if (stepIndex === 6) { // Save Data tab
                    renderUserData();
                }
            };

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetStep = parseInt(button.getAttribute('data-step'));
                    navigateToStep(targetStep);
                });
            });

            // --- Event Listeners for Get Keywords Tab (Step 4) ---
            
            // Function to update the visibility of the "Send to Batch Prompts" button
            const updateBatchSendButtonVisibility = () => {
                if (currentlySelectedKeywordChips.length > 0) {
                    sendKeywordsToBatchBtn.classList.remove('hidden');
                } else {
                    sendKeywordsToBatchBtn.classList.add('hidden');
                }
            };

            clearNicheGeneratorHistoryBtn.addEventListener('click', () => {
                clearHistory('generatedNicheCategories');
                clearHistory('selectedNichesHistory');
                clearHistory('usedPromptKeywords');
                nicheGeneratorOutput.innerHTML = '<p class="text-gray-500">Generated niche category history cleared. New ideas will appear next time.</p>';
                keywordGenerationSection.classList.add('hidden');
                document.getElementById('keyword-grabber-output').innerHTML = '';
                userData.nicheCategory = '';
                userData.selectedSubNiche = '';
                userData.generatedKeywords = [];
                userData.copiedPrompts = [];
                userData.batchPrompts = [];

                currentlySelectedKeywordChips = [];
                updateBatchSendButtonVisibility();
            });

            generateNichesBtn.addEventListener('click', async () => {
                const selectedCategory = nicheCategorySelect.value;
                if (!selectedCategory) {
                    nicheGeneratorError.textContent = 'Please select a niche category.';
                    nicheGeneratorError.classList.remove('hidden');
                    return;
                }

                nicheGeneratorOutput.innerHTML = '';
                nicheGeneratorError.classList.add('hidden');
                nicheGeneratorLoading.classList.remove('hidden');
                generateNichesBtn.disabled = true;

                const hasBeenExploredCategory = isEntryInHistory('generatedNicheCategories', selectedCategory);
                if (hasBeenExploredCategory) {
                    displayMessageBox(customAlertMessageBox, `You've explored category "${selectedCategory}" before.`, '#EF4444');
                }

                try {
                    const prompt = `Generate 15 highly selective, high-demand, and relatively low-competition stock photo/video sub-niches within the '${selectedCategory}' category. For each niche, provide only the niche name (without numbering or description). Present as a comma-separated list.`;
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${errorData.error?.message || response.statusText}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        const text = result.candidates[0].content.parts[0].text;
                        const niches = text.split(',').map(n => n.trim()).filter(Boolean);
                        
                        nicheGeneratorOutput.innerHTML = niches.map(nicheText => {
                            const isNicheAlreadySelected = isEntryInHistory('selectedNichesHistory', nicheText);
                            return `<div class="niche-card bg-white p-3 rounded-xl shadow-sm text-base text-center ${isNicheAlreadySelected ? 'selected' : ''}" data-niche-name="${nicheText}">${nicheText}</div>`;
                        }).join('');
                        addEntryToHistory('generatedNicheCategories', selectedCategory);
                        userData.nicheCategory = selectedCategory;

                        document.querySelectorAll('#niche-generator-output .niche-card').forEach(card => {
                            card.addEventListener('click', async (event) => {
                                const nicheName = event.currentTarget.getAttribute('data-niche-name');
                                
                                if (isEntryInHistory('selectedNichesHistory', nicheName)) {
                                    displayMessageBox(customAlertMessageBox, `You've already selected "${nicheName}".`, '#EF4444');
                                }

                                document.querySelectorAll('#niche-generator-output .niche-card').forEach(c => c.classList.remove('selected'));
                                event.currentTarget.classList.add('selected');
                                
                                selectedNicheDisplay.textContent = nicheName;
                                keywordGenerationSection.classList.remove('hidden');
                                localStorage.setItem('currentSelectedSubNiche', nicheName);
                                userData.selectedSubNiche = nicheName;
                                addEntryToHistory('selectedNichesHistory', nicheName);

                                keywordGrabberOutput.innerHTML = '';
                                keywordGrabberError.classList.add('hidden');
                                keywordGrabberLoading.classList.remove('hidden');
                                userData.generatedKeywords = [];
                                
                                currentlySelectedKeywordChips = [];
                                updateBatchSendButtonVisibility();

                                try {
                                    const keywordPrompt = `Generate 100 diverse, commercially viable, and specific keywords for stock content related to the niche: '${nicheName}'. Focus on terms buyers would search for on Adobe Stock. Provide only the keywords, separated by commas, with no additional text, numbering, or explanations.`;
                                    const keywordPayload = { contents: [{ role: "user", parts: [{ text: keywordPrompt }] }] };
                                    const keywordApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
                                    
                                    const keywordResponse = await fetch(keywordApiUrl, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(keywordPayload)
                                    });
                                    
                                    if (!keywordResponse.ok) {
                                        const kwErrorData = await keywordResponse.json();
                                        throw new Error(`API error: ${kwErrorData.error?.message || keywordResponse.statusText}`);
                                    }

                                    const kwResult = await keywordResponse.json();
                                    if (kwResult.candidates && kwResult.candidates[0]?.content?.parts[0]?.text) {
                                        const text = kwResult.candidates[0].content.parts[0].text;
                                        let keywords = text.split(',').map(k => k.trim()).filter(Boolean);
                                        
                                        const usedPromptKeywords = getHistory('usedPromptKeywords');
                                        
                                        keywordGrabberOutput.innerHTML = keywords.map(s => {
                                            const isUsed = usedPromptKeywords.includes(s.toLowerCase());
                                            const isSelectedForBatch = currentlySelectedKeywordChips.includes(s);
                                            return `<div class="keyword-chip bg-white p-2 rounded-xl shadow-sm text-center ${isUsed ? 'used' : ''} ${isSelectedForBatch ? 'selected-for-batch' : ''}" data-keyword-name="${s}">${s}</div>`;
                                        }).join('');
                                        
                                        userData.generatedKeywords = keywords;

                                        document.querySelectorAll('#keyword-grabber-output .keyword-chip').forEach(chip => {
                                            chip.addEventListener('click', (k_event) => {
                                                const selectedKeyword = k_event.currentTarget.textContent;
                                                
                                                const isCurrentlySelected = k_event.currentTarget.classList.contains('selected-for-batch');
                                                if (isCurrentlySelected) {
                                                    k_event.currentTarget.classList.remove('selected-for-batch');
                                                    currentlySelectedKeywordChips = currentlySelectedKeywordChips.filter(kw => kw !== selectedKeyword);
                                                } else {
                                                    k_event.currentTarget.classList.add('selected-for-batch');
                                                    currentlySelectedKeywordChips.push(selectedKeyword);
                                                }
                                                updateBatchSendButtonVisibility();

                                                if (isEntryInHistory('usedPromptKeywords', selectedKeyword)) {
                                                    displayMessageBox(customAlertMessageBox, `You've already used "${selectedKeyword}" for a prompt.`, '#EF4444');
                                                }
                                                
                                                promptKeywordInput.value = selectedKeyword;
                                            });
                                        });
                                    } else {
                                        throw new Error('No keywords received.');
                                    }
                                } catch (kw_error) {
                                    console.error('Error generating keywords:', kw_error);
                                    keywordGrabberError.textContent = `Failed to get keywords: ${kw_error.message}.`;
                                    keywordGrabberError.classList.remove('hidden');
                                } finally {
                                    keywordGrabberLoading.classList.add('hidden');
                                }
                            });
                        });
                    } else {
                        throw new Error('No niches received.');
                    }
                } catch (error) {
                    console.error('Error generating niches:', error);
                    nicheGeneratorError.textContent = `Failed to get niches: ${error.message}.`;
                    nicheGeneratorError.classList.remove('hidden');
                } finally {
                    nicheGeneratorLoading.classList.add('hidden');
                    generateNichesBtn.disabled = false;
                }
            });


            // --- Event Listeners for Get Keywords Tab - Stage 2 (Keyword Generation) ---
            
            clearSubNicheKeywordsBtn.addEventListener('click', () => {
                const currentNiche = localStorage.getItem('currentSelectedSubNiche');
                if (currentNiche) {
                    let allSelectedNichesHistory = getHistory('selectedNichesHistory');
                    allSelectedNichesHistory = allSelectedNichesHistory.filter(entry => entry !== currentNiche.toLowerCase());
                    saveHistory('selectedNichesHistory', allSelectedNichesHistory);

                    clearHistory('usedPromptKeywords');

                    keywordGrabberOutput.innerHTML = `<p class="text-gray-500">Keywords history for '${currentNiche}' cleared.</p>`;
                    userData.generatedKeywords = [];
                    userData.copiedPrompts = [];
                    userData.batchPrompts = [];
                    
                    currentlySelectedKeywordChips = [];
                    updateBatchSendButtonVisibility();

                    document.querySelectorAll('#keyword-grabber-output .keyword-chip').forEach(chip => {
                        chip.classList.remove('used');
                        chip.classList.remove('selected-for-batch');
                    });

                } else {
                     keywordGrabberOutput.innerHTML = '<p class="text-gray-500">No niche selected to clear history for.</p>';
                }
            });

            // Listener for the new "Send to Batch Prompts" button
            sendKeywordsToBatchBtn.addEventListener('click', () => {
                if (currentlySelectedKeywordChips.length > 0) {
                    batchKeywordsInput.value = currentlySelectedKeywordChips.join(', ');
                    navigateToStep(5); // Navigate to the Prompt Generator tab (Step 5)
                    currentlySelectedKeywordChips.forEach(kw => {
                        const chip = document.querySelector(`.keyword-chip[data-keyword-name="${kw}"]`);
                        if (chip) chip.classList.remove('selected-for-batch');
                    });
                    currentlySelectedKeywordChips = [];
                    updateBatchSendButtonVisibility();
                } else {
                    displayMessageBox(customAlertMessageBox, 'Please select keywords first!', '#EF4444');
                }
            });


            // --- Event Listeners for Prompt Generator Tab (Step 5) ---
            
            promptKeywordInput.addEventListener('input', () => {
                const keyword = promptKeywordInput.value.trim();
                if (isEntryInHistory('usedPromptKeywords', keyword)) {
                    promptKeywordInput.classList.add('prompt-keyword-input-used');
                    promptKeywordHistoryNote.classList.remove('hidden');
                } else {
                    promptKeywordInput.classList.remove('prompt-keyword-input-used');
                    promptKeywordHistoryNote.classList.add('hidden');
                }
            });

            clearPromptKeywordsBtn.addEventListener('click', () => {
                clearHistory('usedPromptKeywords');
                promptKeywordHistoryNote.classList.add('hidden');
                promptKeywordInput.classList.remove('prompt-keyword-input-used');
                promptsOutput.innerHTML = '<p class="text-gray-500">Prompt keyword history cleared.</p>';
                userData.copiedPrompts = [];

                document.querySelectorAll('#keyword-grabber-output .keyword-chip').forEach(chip => {
                    chip.classList.remove('used');
                });
            });

            // Single Prompt Generation Logic
            generatePromptsBtn.addEventListener('click', async () => {
                const keyword = promptKeywordInput.value.trim();
                if (!keyword) {
                    promptsError.textContent = 'Please enter a keyword.';
                    promptsError.classList.remove('hidden');
                    return;
                }

                promptsOutput.innerHTML = '';
                promptsError.classList.add('hidden');
                promptsLoading.classList.remove('hidden');
                generatePromptsBtn.disabled = true;
                promptKeywordHistoryNote.classList.add('hidden');

                const selectedLength = promptLengthSelect.value;
                let lengthConstraint = "";
                switch (selectedLength) {
                    case 'short':
                        lengthConstraint = "Keep each prompt concise, between 0 and 150 characters.";
                        break;
                    case 'medium':
                        lengthConstraint = "Keep each prompt detailed, between 100 and 280 characters.";
                        break;
                    case 'long':
                        lengthConstraint = "Provide very detailed and elaborate prompts, between 200 and 900 characters.";
                        break;
                }

                try {
                    const prompt = `Generate 10 highly detailed, unique, and commercially viable image prompts for a stock image generation tool (like Leonardo AI or Midjourney) based on the core concept/keyword "${keyword}". ${lengthConstraint} Each prompt should be a single, cohesive paragraph that clearly defines:
                    1.  <b>Subject + Action + Setting:</b> What is the main subject, what are they doing, and where are they?
                    2.  <b>Specific style/details:</b> Artistic style (e.g., photorealistic, cinematic, isometric, minimalist), textures, specific objects, expressions, or visual elements.
                    3.  <b>Lighting:</b> Describe the quality, direction, and mood of the lighting.
                    4.  <b>Colors:</b> Mention the dominant color palette or desired color mood.
                    5.  <b>Composition:</b> How is the scene framed?
                    6.  <b>Technical details:</b> Resolution, background type (e.g., "pure white background", "on transparent background"), lens effects, depth of field.
                    7.  <b>Mood/Emotion:</b> The overall feeling or message the image should convey.
                    Present each prompt as a numbered list item (1. [Prompt text], 2. [Prompt text], etc.). Ensure no additional conversational text beyond the prompts themselves.`;
                    
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API error: ${errorData.error?.message || response.statusText}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                        const text = result.candidates[0].content.parts[0].text;
                        const promptLines = text.split('\n').filter(line => line.trim().match(/^\d+\.\s*/)).map(line => line.trim()); 
                        
                        promptsOutput.innerHTML = promptLines.map((p, index) => {
                            const isPromptUsed = userData.copiedPrompts.some(cp => cp.text === p && cp.used);
                            return `
                                <div class="prompt-chip-item bg-gray-50 p-3 rounded-xl border text-sm flex justify-between items-center ${isPromptUsed ? 'used' : ''}" data-prompt-index="${index}">
                                    <span class="flex-grow mr-2">${p}</span>
                                    <button class="copy-prompt-btn bg-indigo-500 text-white text-xs font-semibold px-3 py-1 rounded-md hover:bg-indigo-600 transition">Copy</button>
                                </div>
                            `;
                        }).join('');
                        
                        addEntryToHistory('usedPromptKeywords', keyword);
                        if (isEntryInHistory('usedPromptKeywords', keyword)) {
                            promptKeywordInput.classList.add('prompt-keyword-input-used');
                        }

                        const newPromptsData = promptLines.map(p => {
                            const existing = userData.copiedPrompts.find(cp => cp.text === p);
                            return existing ? existing : { text: p, used: false };
                        });
                        userData.copiedPrompts = newPromptsData;


                        document.querySelectorAll('.copy-prompt-btn').forEach(button => {
                            button.addEventListener('click', async (p_event) => {
                                const promptTextElement = p_event.currentTarget.previousElementSibling;
                                const promptText = promptTextElement.textContent;
                                const parentItem = p_event.currentTarget.closest('.prompt-chip-item');
                                const promptIndex = parseInt(parentItem.getAttribute('data-prompt-index'));

                                if (parentItem) {
                                    parentItem.classList.remove('copied');
                                    void parentItem.offsetWidth; 
                                }

                                await copyToClipboard(promptText, promptCopyMessage);

                                if (parentItem) {
                                    parentItem.classList.add('copied');
                                    setTimeout(() => {
                                        parentItem.classList.add('used');
                                    }, 500);
                                }

                                if (userData.copiedPrompts[promptIndex]) {
                                    userData.copiedPrompts[promptIndex].used = true;
                                }
                            });
                        });
                    } else {
                        throw new Error('No prompts received.');
                    }
                } catch (error) {
                    console.error('Error generating prompts:', error);
                    promptsError.textContent = `Failed to get prompts: ${error.message}.`;
                    promptsError.classList.remove('hidden');
                } finally {
                    promptsLoading.classList.add('hidden');
                    generatePromptsBtn.disabled = false;
                }
            });

            // Batch Prompt Generation Logic
            generateBatchPromptsBtn.addEventListener('click', async () => {
                const batchKeywordsRaw = batchKeywordsInput.value.trim();
                if (!batchKeywordsRaw) {
                    batchPromptsError.textContent = 'Please enter keywords for batch generation.';
                    batchPromptsError.classList.remove('hidden');
                    return;
                }

                const keywords = batchKeywordsRaw.split(/[\n,]+/).map(k => k.trim()).filter(Boolean);

                if (keywords.length === 0) {
                    batchPromptsError.textContent = 'No valid keywords found for batch generation.';
                    batchPromptsError.classList.remove('hidden');
                    return;
                }
                if (keywords.length > 100) {
                    batchPromptsError.textContent = 'Please limit keywords to 100 for batch generation.';
                    batchPromptsError.classList.remove('hidden');
                    return;
                }


                batchPromptsError.classList.add('hidden');
                batchPromptsLoading.classList.remove('hidden');
                generateBatchPromptsBtn.disabled = true;
                
                userData.batchPrompts = []; // Clear previous batch prompts

                const selectedLength = batchPromptLengthSelect.value;
                let lengthConstraint = "";
                switch (selectedLength) {
                    case 'short':
                        lengthConstraint = "Keep each prompt concise, between 0 and 150 characters.";
                        break;
                    case 'medium':
                        lengthConstraint = "Keep each prompt detailed, between 100 and 280 characters.";
                        break;
                    case 'long':
                        lengthConstraint = "Provide very detailed and elaborate prompts, between 200 and 900 characters.";
                        break;
                }

                let generatedCount = 0;
                for (const keyword of keywords) {
                    try {
                        const prompt = `Generate 10 highly detailed, unique, and commercially viable image prompts for a stock image generation tool (like Leonardo AI or Midjourney) based on the core concept/keyword "${keyword}". ${lengthConstraint} Each prompt should be a single, cohesive paragraph that clearly defines:
                        1.  <b>Subject + Action + Setting:</b> What is the main subject, what are they doing, and where are they?
                        2.  <b>Specific style/details:</b> Artistic style (e.g., photorealistic, cinematic, isometric, minimalist), textures, specific objects, expressions, or visual elements.
                        3.  <b>Lighting:</b> Describe the quality, direction, and mood of the lighting.
                        4.  <b>Colors:</b> Mention the dominant color palette or desired color mood.
                        5.  <b>Composition:</b> How is the scene framed?
                        6.  <b>Technical details:</b> Resolution, background type (e.g., "pure white background", "on transparent background"), lens effects, depth of field.
                        7.  <b>Mood/Emotion:</b> The overall feeling or message the image should convey.
                        Present each prompt as a numbered list item (1. [Prompt text], 2. [Prompt text], etc.). Ensure no additional conversational text beyond the prompts themselves.`;
                        
                        const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(`API error for keyword "${keyword}": ${errorData.error?.message || response.statusText}`);
                        }

                        const result = await response.json();
                        if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                            const text = result.candidates[0].content.parts[0].text;
                            const generatedPrompts = text.split('\n').filter(line => line.trim().match(/^\d+\.\s*/)).map(line => ({ text: line.trim(), used: false }));
                            userData.batchPrompts.push({ keyword: keyword, prompts: generatedPrompts });
                            generatedCount++;
                        } else {
                            throw new Error(`No prompts received for keyword "${keyword}".`);
                        }
                    } catch (error) {
                        console.error('Error generating batch prompts:', error);
                        batchPromptsError.textContent = `Error processing "${keyword}": ${error.message}.`;
                        batchPromptsError.classList.remove('hidden');
                        break; 
                    }
                }

                batchPromptsLoading.classList.add('hidden');
                generateBatchPromptsBtn.disabled = false;
                if (generatedCount > 0) {
                    displayMessageBox(customAlertMessageBox, `Generated prompts for ${generatedCount} keyword(s). Check the Batch Prompt Generator section.`, '#10B981');
                    renderBatchPromptsOutput(); // Render output directly in Step 5
                } else if (!batchPromptsError.classList.contains('hidden')) {
                } else {
                    batchPromptsError.textContent = 'No prompts could be generated. Try adjusting keywords or prompt length.';
                    batchPromptsError.classList.remove('hidden');
                }
            });

            // Clear Batch Prompts Button
            clearBatchPromptsBtn.addEventListener('click', () => {
                userData.batchPrompts = [];
                renderBatchPromptsOutput();
                displayMessageBox(customAlertMessageBox, 'Batch prompts cleared!', '#10B981');
            });


            // --- Event Listeners for Smart Tagging & Export Tab (Step 7) ---
            
            // Update slider values
            titleLengthSlider.addEventListener('input', () => {
                titleLengthValue.textContent = titleLengthSlider.value;
            });
            tagsLimitSlider.addEventListener('input', () => {
                tagsLimitValue.textContent = tagsLimitSlider.value;
            });

            imageUploadInput.addEventListener('change', (event) => {
                uploadedFiles = Array.from(event.target.files);
                if (uploadedFiles.length > 0) {
                    uploadStatus.textContent = `Ready to analyze ${uploadedFiles.length} image(s).`;
                    imagePreviewsContainer.innerHTML = ''; // Clear previous previews
                    imagePreviewsContainer.classList.remove('hidden');
                    analyzeImagesBtn.disabled = false;
                    metadataResultsContainer.classList.add('hidden'); // Hide previous results
                    metadataTableBody.innerHTML = '';
                    generatedMetadata = [];
                    
                    uploadedFiles.forEach(file => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imgDiv = document.createElement('div');
                            imgDiv.className = 'relative w-24 h-24 rounded-xl overflow-hidden bg-gray-200 flex items-center justify-center';
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.className = 'w-full h-full object-cover';
                            imgDiv.appendChild(img);
                            imagePreviewsContainer.appendChild(imgDiv);
                        };
                        reader.readAsDataURL(file);
                    });

                } else {
                    uploadStatus.textContent = 'No images selected.';
                    analyzeImagesBtn.disabled = true;
                    imagePreviewsContainer.classList.add('hidden');
                }
            });

            analyzeImagesBtn.addEventListener('click', async () => {
                if (uploadedFiles.length === 0) {
                    metadataError.textContent = 'Please upload images first.';
                    metadataError.classList.remove('hidden');
                    return;
                }

                metadataResultsContainer.classList.add('hidden');
                metadataTableBody.innerHTML = '';
                generatedMetadata = [];
                metadataError.classList.add('hidden');
                metadataLoading.classList.remove('hidden');
                analyzeImagesBtn.disabled = true;
                exportCsvBtn.disabled = true;

                const titleLength = parseInt(titleLengthSlider.value);
                const tagsLimit = parseInt(tagsLimitSlider.value);
                const addTransparentBgToTitle = transparentBackgroundToggle.checked;

                let processedCount = 0;
                for (const file of uploadedFiles) {
                    uploadStatus.textContent = `Analyzing ${processedCount + 1} of ${uploadedFiles.length}: ${file.name}`;
                    try {
                        const base64Image = await new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result.split(',')[1]);
                            reader.onerror = error => reject(error);
                            reader.readAsDataURL(file);
                        });

                        const mimeType = file.type;

                        let titlePrompt = `Generate a concise, descriptive, and SEO-friendly title for a stock image based on its content. Keep it between ${titleLength} and ${titleLength + 20} characters.`;
                        if (addTransparentBgToTitle) {
                            titlePrompt += ` If the image appears to have a transparent background, also add "on transparent background" to the title.`;
                        }
                        titlePrompt += ` Provide only the title, no extra text.`;

                        const titlePayload = {
                            contents: [{
                                parts: [
                                    { text: titlePrompt },
                                    { inlineData: { mimeType: mimeType, data: base64Image } }
                                ]
                            }]
                        };

                        const keywordPrompt = `Generate ${tagsLimit} highly relevant, commercially viable, and diverse keywords for a stock image based on its content. Provide only the keywords, separated by commas, no extra text or numbering.`;
                        const keywordPayload = {
                            contents: [{
                                parts: [
                                    { text: keywordPrompt },
                                    { inlineData: { mimeType: mimeType, data: base64Image } }
                                ]
                            }]
                        };

                        const MODEL_NAME_FOR_VISION = "gemini-1.5-flash"; 

                        const titleResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME_FOR_VISION}:generateContent?key=${GEMINI_API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(titlePayload)
                        });
                        const titleResult = await titleResponse.json();
                        let generatedTitle = 'Title Generation Error';
                        if (titleResult.candidates && titleResult.candidates[0]?.content?.parts[0]?.text) {
                            generatedTitle = titleResult.candidates[0].content.parts[0].text.replace(/^["']|["']$/g, '').trim();
                        } else if (titleResult.error) {
                            generatedTitle = `Title API Error: ${titleResult.error.message}`;
                        }

                        const keywordResponse = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME_FOR_VISION}:generateContent?key=${GEMINI_API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(keywordPayload)
                        });
                        const keywordResult = await keywordResponse.json();
                        let generatedKeywords = 'Keywords Generation Error';
                        if (keywordResult.candidates && keywordResult.candidates[0]?.content?.parts[0]?.text) {
                            generatedKeywords = keywordResult.candidates[0].content.parts[0].text.replace(/["']|\.+$/g, '').trim();
                            generatedKeywords = generatedKeywords.split(',').map(k => k.trim()).filter(Boolean).slice(0, tagsLimit).join(', ');
                        } else if (keywordResult.error) {
                            generatedKeywords = `Keywords API Error: ${keywordResult.error.message}`;
                        }

                        generatedMetadata.push({
                            fileName: file.name,
                            title: generatedTitle,
                            keywords: generatedKeywords
                        });

                        const row = metadataTableBody.insertRow();
                        row.innerHTML = `
                            <td class="px-2 py-2 whitespace-nowrap"><img src="${URL.createObjectURL(file)}" class="h-12 w-12 object-cover rounded-xl inline-block mr-2" alt="${file.name}"> ${file.name}</td>
                            <td class="px-2 py-2">${generatedTitle}</td>
                            <td class="px-2 py-2 text-wrap">${generatedKeywords}</td>
                        `;
                    } catch (error) {
                        console.error(`Error processing image ${file.name}:`, error);
                        metadataError.textContent = `Error processing ${file.name}: ${error.message}. Check your API key or browser console.`;
                        metadataError.classList.remove('hidden');
                        generatedMetadata.push({
                            fileName: file.name,
                            title: 'Error generating',
                            keywords: 'Error generating'
                        });
                         const row = metadataTableBody.insertRow();
                        row.innerHTML = `
                            <td class="px-2 py-2 whitespace-nowrap"><img src="${URL.createObjectURL(file)}" class="h-12 w-12 object-cover rounded-xl inline-block mr-2" alt="${file.name}"> ${file.name}</td>
                            <td class="px-2 py-2 text-red-500">Error generating</td>
                            <td class="px-2 py-2 text-red-500">Error generating</td>
                        `;
                    }
                    processedCount++;
                    uploadStatus.textContent = `Analyzed ${processedCount} of ${uploadedFiles.length}.`;
                }

                metadataLoading.classList.add('hidden');
                analyzeImagesBtn.disabled = false;
                metadataResultsContainer.classList.remove('hidden');
                exportCsvBtn.disabled = generatedMetadata.length === 0;
                uploadStatus.textContent = `Analysis complete for ${uploadedFiles.length} images.`;
            });

            exportCsvBtn.addEventListener('click', () => {
                let csvContent = "File Name,Title,Keywords\n";
                generatedMetadata.forEach(row => {
                    const escapedTitle = `"${row.title.replace(/"/g, '""')}"`;
                    const escapedKeywords = `"${row.keywords.replace(/"/g, '""')}"`;
                    csvContent += `${row.fileName},${escapedTitle},${escapedKeywords}\n`;
                });

                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                if (link.download !== undefined) {
                    const url = URL.createObjectURL(blob);
                    link.setAttribute('href', url);
                    link.setAttribute('download', 'adobe_stock_metadata.csv');
                    link.style.visibility = 'hidden';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert('Your browser does not support downloading CSV files directly. Please copy the data manually.');
                }
            });


            // Charts (Step 9)
            new Chart(document.getElementById('growthChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Month 1', 'Month 3', 'Month 6', 'Month 9', 'Month 12'],
                    datasets: [{
                        label: 'Potential Earnings (Illustrative)',
                        data: [25, 75, 250, 500, 1000],
                        backgroundColor: 'rgba(139, 92, 246, 0.2)',
                        borderColor: '#8B5CF6',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            title: { display: true, text: 'Earnings ($)', color: '#4B5563' },
                            ticks: { color: '#6B7280' },
                            grid: { color: '#E5E7EB' }
                        },
                        x: { 
                            title: { display: true, text: 'Time', color: '#4B5563' },
                            ticks: { color: '#6B7280' },
                            grid: { color: '#E5E7EB' }
                        }
                    }
                }
            });

            new Chart(document.getElementById('mixChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Organic Photos', 'AI Images', 'Videos'],
                    datasets: [{
                        data: [50, 40, 10],
                        backgroundColor: ['#8B5CF6', '#7C3AED', '#6D28D9'],
                        hoverOffset: 8
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    plugins: { 
                        legend: { 
                            position: 'bottom', 
                            labels: { color: '#4B5563' } 
                        } 
                    }
                }
            });
        });
    </script>
</body>
</html>
